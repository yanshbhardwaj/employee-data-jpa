<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <title>Spring Security Example </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
<div class="container" style="margin-top: 20px;">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <ul class="navbar-nav header">
                <li class="nav-item me-3 ">
                    <a class="nav-link active" href="/">Home</a>
                </li>
                <li class="nav-item me-3">
                    <a class="nav-link" href="/employee">See Employee List</a>
                </li>
                <li class="nav-item me-3">
                    <a class="nav-link" aria-current="page" href="/employeeData">Add Employee Data</a>
                </li>
            </ul>
        </div>

    </nav>
<form class="row g-3" th:action="@{/employee/employeedata}"  method="post" id="employee">
    <div class="col-md-8">
        <label for="jobTitle" class="form-label">JobTitle</label>
        <input type="text" class="form-control" name="jobTitle" id="jobTitle">
    </div>
    <div class="col-md-8">
        <label for="firstName" class="form-label">FirstName</label>
        <input type="text" class="form-control" name="firstName" id="firstName">
    </div>
    <div class="col-md-8">
        <label for="lastName" class="form-label">LastName</label>
        <input type="text" class="form-control" name="lastName" id="lastName">
    </div>
    <div class="col-md-8">
        <label for="phoneNumber" class="form-label">PhoneNumber</label>
        <input type="number" class="form-control" name="phoneNumber" id="phoneNumber">
    </div>
    <div class="col-md-8">
        <label for="emailAddress" class="form-label">EmailAddress</label>
        <input type="email" class="form-control" name="emailAddress" id="emailAddress">
    </div>
    <div class="col-md-8">
    <button type="submit" class="btn btn-primary">Add Data</button>
    </div>
</form>
</div>
<div class="col-md-8">
    <form th:action="@{/logout}" method="post" style="margin-bottom:20px">
        <input type="submit" value="Sign Out"/>
    </form>
</div>
<script>
    async function postFormDataAsJson({ url , formData }) {
	const plainFormData = JSON.stringify(Object.fromEntries(formData.entries()));

	const fetchOptions = {

	   credentials: 'include',
		method: "POST",
		headers: {
			"Content-Type": "application/json",
			Accept: "application/json",
		},
		body: plainFormData,
	};

	const response = await fetch(url, fetchOptions);
    console.log(response);
	if (!response.ok) {
		const errorMessage = await response.text();
		throw new Error(errorMessage);
	}

	return response.json();
}

async function handleFormSubmit(event) {
	event.preventDefault();

	const form = event.currentTarget;
	const url = "/employee/employeedata";
    console.log(form)
	try {
		const formData = new FormData(form);

		const responseData = await postFormDataAsJson({ url, formData });

		console.log({ responseData });
	} catch (error) {
		console.error(error);
	}
}
const data = document.getElementById("employee");
data.addEventListener("submit", handleFormSubmit);
</script>
</body>
</html>